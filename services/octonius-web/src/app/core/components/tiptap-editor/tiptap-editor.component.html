<div class="tiptap-editor-wrapper" [style.max-height]="config.maxHeight" [style.min-height]="config.minHeight">
  <!-- Toolbar (optional) -->
  <div *ngIf="config.showToolbar" class="tiptap-toolbar bg-base-200 border-b border-base-300 px-3 py-2">
    <div class="flex flex-wrap items-center gap-1">
      <!-- Undo/Redo -->
      <div class="flex items-center gap-1">
        <button 
          class="btn btn-ghost btn-xs"
          [disabled]="!canUndo()"
          (click)="undo()"
          title="Undo">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
          </svg>
        </button>
        <button 
          class="btn btn-ghost btn-xs"
          [disabled]="!canRedo()"
          (click)="redo()"
          title="Redo">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6" />
          </svg>
        </button>
      </div>

      <div class="divider divider-horizontal mx-1"></div>

      <!-- Text Formatting -->
      <div class="flex items-center gap-1">
        <button 
          *ngIf="config.toolbarItems?.includes('bold')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('bold')"
          (click)="toggleBold()"
          title="Bold">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z" />
          </svg>
        </button>
        <button 
          *ngIf="config.toolbarItems?.includes('italic')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('italic')"
          (click)="toggleItalic()"
          title="Italic">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 4l4 8-4 8M6 16l2.5-4L6 8" />
          </svg>
        </button>
        <button 
          *ngIf="config.toolbarItems?.includes('underline')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('underline')"
          (click)="toggleUnderline()"
          title="Underline">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a4 4 0 100 8v0a4 4 0 100-8zm0 0V4m0 18h8" />
          </svg>
        </button>
        <button 
          *ngIf="config.toolbarItems?.includes('strike')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('strike')"
          (click)="toggleStrike()"
          title="Strikethrough">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h12M6 12a6 6 0 106 6h-6a6 6 0 01-6-6z" />
          </svg>
        </button>
      </div>

      <div class="divider divider-horizontal mx-1"></div>

      <!-- Lists -->
      <div class="flex items-center gap-1">
        <button 
          *ngIf="config.toolbarItems?.includes('bulletList')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('bulletList')"
          (click)="toggleBulletList()"
          title="Bullet List">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
          </svg>
        </button>
        <button 
          *ngIf="config.toolbarItems?.includes('orderedList')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('orderedList')"
          (click)="toggleOrderedList()"
          title="Numbered List">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
        <button 
          *ngIf="config.toolbarItems?.includes('taskList')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('taskList')"
          (click)="toggleTaskList()"
          title="Task List">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </button>
      </div>

      <div class="divider divider-horizontal mx-1"></div>

      <!-- More Options -->
      <div class="flex items-center gap-1">
        <button 
          *ngIf="config.toolbarItems?.includes('link')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('link')"
          (click)="setLink()"
          title="Link">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
          </svg>
        </button>
        
        <!-- Enhanced Image Button with Options -->
        <div class="relative" *ngIf="config.toolbarItems?.includes('image') || config.enableImageUpload">
          <button 
            class="btn btn-ghost btn-xs image-btn"
            [disabled]="isUploadingImage"
            (click)="showImageOptions = !showImageOptions; showEmojiPicker = false; showGifPicker = false"
            title="Insert Image">
            <svg *ngIf="!isUploadingImage" xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <svg *ngIf="isUploadingImage" class="animate-spin h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </button>
          <!-- Image Options Dropdown -->
          <div class="absolute top-full left-0 mt-2 p-2 bg-base-100 border border-base-300 rounded-lg shadow-xl z-50 text-xs image-options-container"
               *ngIf="showImageOptions">
            <div class="space-y-1">
              <button 
                (click)="insertImageFromFile(); showImageOptions = false"
                class="w-full text-left px-2 py-1 hover:bg-base-200 rounded flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                </svg>
                Upload Image
              </button>
              <button 
                (click)="insertImageFromUrl(); showImageOptions = false"
                class="w-full text-left px-2 py-1 hover:bg-base-200 rounded flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                </svg>
                From URL
              </button>
            </div>
          </div>
          <!-- Image Upload Error Toast -->
          <div *ngIf="imageUploadError" 
               class="absolute top-full left-0 mt-2 p-2 bg-error text-error-content rounded-lg shadow-lg z-50 text-xs max-w-xs">
            {{ imageUploadError }}
            <button (click)="clearImageUploadError()" class="ml-2 text-error-content hover:text-error-content/80">âœ•</button>
          </div>
        </div>

        <!-- Emoji Picker -->
        <div class="relative" *ngIf="config.enableEmojiPicker">
          <button 
            class="btn btn-ghost btn-xs emoji-picker-btn"
            [class.btn-active]="showEmojiPicker"
            (click)="showEmojiPicker = !showEmojiPicker; showGifPicker = false; showImageOptions = false"
            title="Insert Emoji">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </button>
          <!-- Emoji Picker Dropdown -->
          <div class="emoji-picker-container absolute top-full left-0 mt-2 p-3 bg-base-100 border border-base-300 rounded-lg shadow-xl z-50 w-80"
               *ngIf="showEmojiPicker">
            <div class="mb-2">
              <input 
                type="text" 
                [(ngModel)]="emojiSearchTerm"
                placeholder="Search emojis..." 
                class="input input-bordered input-sm w-full">
            </div>
            <div class="max-h-64 overflow-y-auto">
              <!-- Recently Used -->
              <div class="mb-3" *ngIf="recentEmojis.length > 0">
                <h5 class="text-xs font-semibold text-base-content/70 mb-1">Recently Used</h5>
                <div class="grid grid-cols-10 gap-1">
                  <button 
                    *ngFor="let emoji of recentEmojis"
                    (click)="insertEmoji(emoji)"
                    class="text-xl p-1 hover:bg-base-200 rounded cursor-pointer transition-colors"
                    [title]="emoji">
                    {{ emoji }}
                  </button>
                </div>
              </div>
              <!-- Emoji Categories -->
              <div *ngFor="let category of emojiCategories" class="mb-3">
                <h5 class="text-xs font-semibold text-base-content/70 mb-1">{{ category.name }}</h5>
                <div class="grid grid-cols-10 gap-1">
                  <button 
                    *ngFor="let emoji of category.emojis"
                    (click)="insertEmoji(emoji)"
                    class="text-xl p-1 hover:bg-base-200 rounded cursor-pointer transition-colors"
                    [title]="emoji">
                    {{ emoji }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- GIF Picker -->
        <div class="relative" *ngIf="config.enableEmojiPicker">
          <button 
            class="btn btn-ghost btn-xs gif-picker-btn"
            [class.btn-active]="showGifPicker"
            (click)="showGifPicker = !showGifPicker; showEmojiPicker = false; showImageOptions = false"
            title="Insert GIF">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </button>
          <!-- GIF Picker Dropdown -->
          <div class="gif-picker-container absolute top-full left-0 mt-2 p-3 bg-base-100 border border-base-300 rounded-lg shadow-xl z-50 w-80"
               *ngIf="showGifPicker">
            <div class="mb-2">
              <div class="join w-full">
                <input 
                  type="text" 
                  [(ngModel)]="gifSearchTerm"
                  (keyup.enter)="searchGifs()"
                  placeholder="Search GIFs..." 
                  class="input input-bordered input-sm join-item flex-1">
                <button 
                  class="btn btn-sm btn-primary join-item"
                  (click)="searchGifs()"
                  [disabled]="isLoadingGifs">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" *ngIf="!isLoadingGifs" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                  <svg *ngIf="isLoadingGifs" class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="max-h-64 overflow-y-auto">
              <div class="grid grid-cols-2 gap-2" *ngIf="gifSearchResults.length > 0">
                <div 
                  *ngFor="let gif of gifSearchResults"
                  class="cursor-pointer hover:opacity-80 transition-opacity">
                  <img 
                    [src]="gif.url" 
                    [alt]="gif.title"
                    (click)="insertGif(gif.url)"
                    class="w-full h-24 object-cover rounded">
                </div>
              </div>
              <div class="text-center text-base-content/50 py-8" *ngIf="gifSearchResults.length === 0 && !isLoadingGifs">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 mx-auto mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <p class="text-sm">Search for GIFs to insert</p>
              </div>
              <div class="text-center py-8" *ngIf="isLoadingGifs">
                <svg class="animate-spin h-6 w-6 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </div>
            </div>
            <div class="text-xs text-base-content/50 mt-2">
              Powered by Giphy
            </div>
          </div>
        </div>

        <button 
          *ngIf="config.toolbarItems?.includes('blockquote')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('blockquote')"
          (click)="toggleBlockquote()"
          title="Quote">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
          </svg>
        </button>
        <button 
          *ngIf="config.toolbarItems?.includes('codeBlock')"
          class="btn btn-ghost btn-xs"
          [class.btn-active]="isActive('codeBlock')"
          (click)="toggleCodeBlock()"
          title="Code Block">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
        </button>
      </div>

      <!-- Table Controls (shown only when in a table) -->
      <div class="divider divider-horizontal mx-1" *ngIf="isActive('table') && config.enableTableControls"></div>
      <div class="dropdown dropdown-bottom" *ngIf="isActive('table') && config.enableTableControls">
        <label tabindex="0" class="btn btn-ghost btn-xs">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
          Table
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </label>
        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
          <li>
            <a (click)="addTableRow()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Add Row Below
            </a>
          </li>
          <li>
            <a (click)="addTableRowBefore()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Add Row Above
            </a>
          </li>
          <li>
            <a (click)="addTableColumn()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Add Column Right
            </a>
          </li>
          <li>
            <a (click)="addTableColumnBefore()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              Add Column Left
            </a>
          </li>
          <li class="divider"></li>
          <li>
            <a (click)="deleteTableRow()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Delete Row
            </a>
          </li>
          <li>
            <a (click)="deleteTableColumn()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
              Delete Column
            </a>
          </li>
          <li class="divider"></li>
          <li>
            <a (click)="toggleTableHeader()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
              </svg>
              Toggle Header Row
            </a>
          </li>
          <li>
            <a (click)="mergeCells()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Merge Cells
            </a>
          </li>
          <li>
            <a (click)="splitCell()">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
              </svg>
              Split Cell
            </a>
          </li>
          <li class="divider"></li>
          <li>
            <a (click)="deleteTable()" class="text-error">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Delete Table
            </a>
          </li>
        </ul>
      </div>

      <!-- Table Insert Button -->
      <div class="flex items-center gap-1" *ngIf="config.enableTableControls && !isActive('table')">
        <button 
          class="btn btn-ghost btn-xs"
          (click)="insertTable()"
          title="Insert Table">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H6a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
        </button>
      </div>

      <!-- Character Count (optional) -->
      <div *ngIf="config.showCharacterCount" class="ml-auto text-xs text-base-content/60">
        {{ getCharacterCount() }} chars
      </div>
    </div>
  </div>

  <!-- Editor Content Area -->
  <div class="tiptap-content-area bg-base-100 border border-base-300 rounded-b-lg relative">
    <div class="tiptap-editor bg-base-100 border border-base-300 text-base-content rounded-lg w-full" #editorElement></div>
    
    <!-- Image Upload Loading Overlay -->
    <div *ngIf="isUploadingImage" class="absolute inset-0 bg-base-100/80 backdrop-blur-sm flex items-center justify-center z-10 rounded-lg">
      <div class="flex flex-col items-center gap-2 p-4 bg-base-200 rounded-lg shadow-lg">
        <svg class="animate-spin h-6 w-6 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="text-sm text-base-content">Uploading image...</span>
        <div *ngIf="imageUploadProgress !== null" class="w-full bg-base-300 rounded-full h-1">
          <div class="bg-primary h-1 rounded-full transition-all duration-300" [style.width.%]="imageUploadProgress"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bubble Menu (hidden, will be positioned by Tiptap) -->
<div *ngIf="config.showBubbleMenu" #bubbleMenuElement class="bubble-menu">
  <div class="flex items-center gap-1 bg-base-200 border border-base-300 rounded shadow-lg p-2">
    <!-- Bold -->
    <button 
      class="btn btn-ghost btn-xs"
      [class.btn-active]="isActive('bold')"
      (click)="toggleBold()"
      title="Bold">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z" />
      </svg>
    </button>
    
    <!-- Italic -->
    <button 
      class="btn btn-ghost btn-xs"
      [class.btn-active]="isActive('italic')"
      (click)="toggleItalic()"
      title="Italic">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 4l4 8-4 8M6 16l2.5-4L6 8" />
      </svg>
    </button>
    
    <!-- Underline -->
    <button 
      class="btn btn-ghost btn-xs"
      [class.btn-active]="isActive('underline')"
      (click)="toggleUnderline()"
      title="Underline">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a4 4 0 100 8v0a4 4 0 100-8zm0 0V4m0 18h8" />
      </svg>
    </button>
    
    <!-- Code -->
    <button 
      class="btn btn-ghost btn-xs"
      [class.btn-active]="isActive('code')"
      (click)="toggleCode()"
      title="Code">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
      </svg>
    </button>
    
    <!-- Link -->
    <button 
      class="btn btn-ghost btn-xs"
      [class.btn-active]="isActive('link')"
      (click)="setLink()"
      title="Link">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
      </svg>
    </button>
    
    <!-- Image -->
    <button 
      *ngIf="config.enableImageUpload"
      class="btn btn-ghost btn-xs"
      [disabled]="isUploadingImage"
      (click)="insertImageFromFile()"
      title="Insert Image">
      <svg *ngIf="!isUploadingImage" xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
      <svg *ngIf="isUploadingImage" class="animate-spin h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
    </button>
  </div>
</div> 