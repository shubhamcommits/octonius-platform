<div *ngIf="board" class="p-1">
    <!-- Header: View Switcher and Actions -->
    <div class="flex justify-between items-center mb-6">
        <!-- View Switcher (Board, List, Timeline) -->
        <div class="tabs tabs-boxed bg-base-200/50">
            <a class="tab tab-active flex items-center gap-2 !bg-base-100 !text-base-content">
                <lucide-icon name="LayoutGrid" class="w-4 h-4"></lucide-icon> Board
            </a>
            <a class="tab flex items-center gap-2">
                <lucide-icon name="List" class="w-4 h-4"></lucide-icon> List
            </a>
            <a class="tab flex items-center gap-2">
                <lucide-icon name="BarChart3" class="w-4 h-4"></lucide-icon> Timeline
            </a>
        </div>
        <!-- Board Actions (Automator, Sort, etc.) -->
        <div class="flex items-center gap-1">
            <button class="btn btn-ghost btn-sm gap-2">
                <lucide-icon name="Zap" class="w-4 h-4"></lucide-icon> Automator
            </button>
            <button class="btn btn-ghost btn-sm gap-2">
                <lucide-icon name="ArrowUpDown" class="w-4 h-4"></lucide-icon> Sort
            </button>
            <button class="btn btn-ghost btn-sm gap-2">
                <lucide-icon name="Filter" class="w-4 h-4"></lucide-icon> Filter
            </button>
            <button class="btn btn-ghost btn-sm gap-2">
                <lucide-icon name="MoreHorizontal" class="w-4 h-4"></lucide-icon> Options
            </button>
        </div>
    </div>

    <!-- Kanban Board Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 items-start">
        <!-- Loop over columns -->
        <div *ngFor="let column of board.columns" class="bg-base-200/50 rounded-lg p-3 h-full flex flex-col">
            <!-- Column Header -->
            <div class="flex justify-between items-center mb-4 px-1">
                <div>
                    <h3 class="font-semibold text-base">{{ column.name }}</h3>
                    <p class="text-xs text-base-content/60">{{ column.tasks.length }} Tasks, {{ getDoneTasks(column) }} done</p>
                </div>
                <button class="btn btn-ghost btn-xs btn-circle">
                    <lucide-icon name="MoreHorizontal" class="w-4 h-4"></lucide-icon>
                </button>
            </div>
            
            <!-- Task Cards -->
            <div class="flex flex-col gap-3 mb-3">
                <!-- Loop over tasks -->
                <div *ngFor="let task of column.tasks" 
                     class="card bg-base-100 shadow-sm border-l-4 cursor-pointer hover:shadow-md transition-shadow" 
                     [style.border-color]="task.color"
                     (click)="onTaskClick(task)">
                    <div class="card-body p-3">
                        <p class="font-medium text-sm">{{ task.title }}</p>
                        <!-- Labels -->
                        <div class="flex flex-wrap gap-1 my-2">
                            <span *ngFor="let label of task.labels" class="badge text-xs" [style.background-color]="label.color + '20'" [style.color]="label.color">{{ label.text }}</span>
                        </div>
                        <!-- Footer: Assignee and Due Date -->
                        <div class="flex justify-between items-center mt-2">
                             <div class="avatar-group -space-x-3 rtl:space-x-reverse">
                                <div class="avatar border-none">
                                    <div class="w-6">
                                        <img [src]="task.assignee.avatar" [alt]="task.assignee.name" />
                                    </div>
                                </div>
                            </div>
                            <span class="text-xs text-base-content/60">{{ task.dueDate | date:'mediumDate' }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Add Task Button -->
            <button class="btn btn-ghost btn-sm w-full mt-auto">
                <lucide-icon name="Plus" class="w-4 h-4"></lucide-icon> Add task
            </button>
        </div>

        <!-- Add Section Button -->
        <div class="flex items-center">
             <button class="btn btn-ghost w-full">
                <lucide-icon name="Plus" class="w-4 h-4"></lucide-icon> Add section
            </button>
        </div>
    </div>
</div>

<div *ngIf="!board" class="text-center p-8">
  <p>Loading tasks...</p>
</div>
