<div *ngIf="open" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30">
  <div class="bg-base-100 rounded-xl shadow-xl w-full max-w-2xl p-8 relative max-h-[90vh] overflow-y-auto">
    <button class="absolute top-4 right-4 btn btn-ghost btn-sm" (click)="onClose()">
      ✕
    </button>
    <h2 class="text-2xl font-bold mb-6">Create Work Group</h2>
    
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Basic Information -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-base-content/80">Basic Information</h3>
        
        <div>
          <label class="block font-medium mb-1">Group Name *</label>
          <input 
            formControlName="name" 
            class="input input-bordered w-full" 
            placeholder="Enter group name" />
          <div *ngIf="form.get('name')?.invalid && form.get('name')?.touched" class="text-error text-xs mt-1">
            <span *ngIf="form.get('name')?.errors?.['required']">Group name is required.</span>
            <span *ngIf="form.get('name')?.errors?.['minlength']">Group name must be at least 2 characters.</span>
            <span *ngIf="form.get('name')?.errors?.['maxlength']">Group name cannot exceed 100 characters.</span>
          </div>
        </div>

        <div>
          <label class="block font-medium mb-1">Description</label>
          <app-tiptap-editor
            [config]="{
              placeholder: 'Describe the purpose and goals of this group...',
              showToolbar: true,
              showBubbleMenu: true,
              showCharacterCount: true,
              maxHeight: '200px',
              minHeight: '120px',
              toolbarItems: ['bold', 'italic', 'underline', 'bulletList', 'orderedList', 'link']
            }"
            formControlName="description">
          </app-tiptap-editor>
          <div *ngIf="form.get('description')?.invalid && form.get('description')?.touched" class="text-error text-xs mt-1">
            Description cannot exceed 500 characters.
          </div>
        </div>

        <div>
          <label class="block font-medium mb-1">Image URL</label>
          <input 
            formControlName="imageUrl" 
            class="input input-bordered w-full" 
            placeholder="https://..." 
            [readonly]="imageUrlLocked" [disabled]="imageUrlLocked" />
          <div class="text-xs text-base-content/60 mt-1">Optional: Add a custom image for the group</div>
          <div *ngIf="imageUrlLocked" class="mt-2">
            <button type="button" class="btn btn-xs btn-outline btn-error" (click)="clearImageUpload()">
              Clear uploaded image
            </button>
          </div>

          <!-- Image Upload UI -->
          <div class="mt-3 flex flex-col gap-2">
            <label class="block font-medium mb-1">Or upload an image</label>
            <input type="file" accept="image/*" class="file-input file-input-bordered w-full max-w-xs" (change)="onImageFileSelected($event)" [disabled]="uploading" />
            <div *ngIf="imagePreviewUrl" class="mt-2">
              <span class="block text-xs mb-1">Preview:</span>
              <img [src]="imagePreviewUrl" alt="Image preview" class="rounded-lg border border-base-300 max-h-32" />
            </div>
            <div *ngIf="uploading" class="flex items-center gap-2 mt-2">
              <span class="loading loading-spinner loading-md text-primary"></span>
              <span class="text-xs">Uploading image...</span>
            </div>
            <div *ngIf="uploadError" class="text-error text-xs mt-1">{{ uploadError }}</div>
          </div>
        </div>
      </div>

      <!-- Settings -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-base-content/80">Group Settings</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block font-medium mb-1">Visibility *</label>
            <select formControlName="visibility" class="select select-bordered w-full">
              <option value="public">Public - Anyone in the workplace can see and join</option>
              <option value="private">Private - Only invited members can see and join</option>
            </select>
          </div>

          <div>
            <label class="block font-medium mb-1">Default Role *</label>
            <select formControlName="defaultRole" class="select select-bordered w-full">
              <option value="member">Member - Can view and contribute</option>
              <option value="admin">Admin - Can manage the group</option>
            </select>
          </div>
        </div>

        <div class="space-y-3">
          <div class="form-control">
            <label class="label cursor-pointer">
              <span class="label-text">Allow members to invite others</span>
              <input type="checkbox" formControlName="allowMemberInvites" class="checkbox checkbox-primary" />
            </label>
          </div>

          <div class="form-control">
            <label class="label cursor-pointer">
              <span class="label-text">Require approval for new members</span>
              <input type="checkbox" formControlName="requireApproval" class="checkbox checkbox-primary" />
            </label>
          </div>
        </div>
      </div>

      <!-- Metadata -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold text-base-content/80">Additional Information</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block font-medium mb-1">Category</label>
            <input 
              formControlName="category" 
              class="input input-bordered w-full" 
              placeholder="e.g., Development, Marketing, HR" />
          </div>

          <div>
            <label class="block font-medium mb-1">Department</label>
            <input 
              formControlName="department" 
              class="input input-bordered w-full" 
              placeholder="e.g., Engineering, Sales" />
          </div>
        </div>

        <div>
          <label class="block font-medium mb-1">Tags</label>
          <div class="flex gap-2 mb-2">
            <input 
              formControlName="tagInput" 
              class="input input-bordered flex-1" 
              placeholder="Add tags (press Enter)" 
              (keypress)="onTagInputKeyPress($event)" />
            <button 
              type="button" 
              class="btn btn-outline btn-sm" 
              (click)="addTag()"
              [disabled]="!form.get('tagInput')?.value?.trim() || tags.length >= 10">
              Add
            </button>
          </div>
          
          <!-- Tags Display -->
          <div *ngIf="tags.length > 0" class="flex flex-wrap gap-2">
            <span 
              *ngFor="let tag of tags" 
              class="badge badge-primary gap-1">
              {{ tag }}
              <button 
                type="button" 
                class="btn btn-ghost btn-xs" 
                (click)="removeTag(tag)">
                ✕
              </button>
            </span>
          </div>
          
          <div class="text-xs text-base-content/60 mt-1">
            Add up to 10 tags to help categorize your group
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex justify-end gap-3 pt-4 border-t border-base-300">
        <button type="button" class="btn btn-ghost" (click)="onClose()">Cancel</button>
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="form.invalid">
          Create Group
        </button>
      </div>
    </form>
  </div>
</div> 