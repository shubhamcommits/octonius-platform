<div class="profile-container">
  <!-- Skeleton Loader -->
  <ng-container *ngIf="isLoading && !error">
    <div class="animate-pulse space-y-8">
      <!-- Header Skeleton -->
      <div class="flex items-start justify-between">
        <div class="flex items-center gap-6">
          <div class="w-24 h-24 rounded-2xl bg-base-300"></div>
          <div class="space-y-2 flex-1">
            <div class="h-6 w-40 bg-base-300 rounded"></div>
            <div class="h-4 w-32 bg-base-300 rounded"></div>
          </div>
        </div>
        <div class="h-10 w-32 bg-base-300 rounded"></div>
      </div>

      <!-- Account Info Skeleton -->
      <div class="bg-base-100/50 rounded-xl p-6 border border-base-300/50">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/4 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/3 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/3 bg-base-300 rounded mb-2"></div>
        </div>
      </div>

      <!-- Personal Info Skeleton -->
      <div class="bg-base-100/50 rounded-xl p-6 border border-base-300/50">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
        </div>
      </div>

      <!-- Bio Skeleton -->
      <div class="bg-base-100/50 rounded-xl p-6 border border-base-300/50">
        <div class="h-4 w-1/4 bg-base-300 rounded mb-2"></div>
        <div class="h-20 w-full bg-base-300 rounded"></div>
      </div>

      <!-- Preferences Skeleton -->
      <div class="bg-base-100/50 rounded-xl p-6 border border-base-300/50">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
        </div>
        <div class="flex gap-4">
          <div class="h-4 w-24 bg-base-300 rounded"></div>
          <div class="h-4 w-24 bg-base-300 rounded"></div>
          <div class="h-4 w-24 bg-base-300 rounded"></div>
        </div>
      </div>

      <!-- Additional Info Skeleton -->
      <div class="bg-base-100/50 rounded-xl p-6 border border-base-300/50">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
          <div class="h-4 w-1/2 bg-base-300 rounded mb-2"></div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Profile Content -->
  <div *ngIf="!isLoading" class="space-y-8">
    <!-- Header Section with Avatar -->
    <div class="flex items-start justify-between">
      <div class="flex items-center gap-6">
        <!-- Avatar with Upload -->
        <div class="relative group">
          <div class="w-24 h-24 rounded-2xl overflow-hidden bg-gradient-to-br from-primary/20 to-secondary/20 
                      backdrop-blur-xl border-2 border-base-300/50 shadow-xl">
            <img *ngIf="avatarPreview" 
                 [src]="avatarPreview" 
                 [alt]="fullName"
                 class="w-full h-full object-cover">
            <div *ngIf="!avatarPreview" 
                 class="w-full h-full flex items-center justify-center text-2xl font-bold text-primary">
              {{ initials }}
            </div>
          </div>
          
          <!-- Upload Overlay -->
          <div *ngIf="isEditing" 
               class="absolute inset-0 bg-black/50 rounded-2xl opacity-0 group-hover:opacity-100 
                      transition-opacity duration-300 flex items-center justify-center cursor-pointer">
            <label for="avatar-upload" class="cursor-pointer">
              <lucide-icon name="Upload" class="w-6 h-6 text-white"></lucide-icon>
              <input type="file" 
                     id="avatar-upload" 
                     class="hidden" 
                     accept="image/*"
                     (change)="onFileSelected($event)">
            </label>
          </div>
        </div>

        <!-- User Info -->
        <div>
          <h1 class="text-2xl font-bold">{{ fullName }}</h1>
          <p class="text-base-content/70">{{ user?.email }}</p>
        </div>
      </div>

      <!-- Edit Button -->
      <button *ngIf="!isEditing" 
              (click)="toggleEdit()"
              class="btn btn-primary btn-sm gap-2">
        <lucide-icon name="Edit" class="w-4 h-4"></lucide-icon>
        Edit Profile
      </button>

      <!-- Save/Cancel Buttons -->
      <div *ngIf="isEditing" class="flex gap-2">
        <button (click)="saveProfile()" 
                [disabled]="profileForm.invalid || isLoading"
                class="btn btn-primary btn-sm gap-2">
          <lucide-icon name="Save" class="w-4 h-4"></lucide-icon>
          Save Changes
        </button>
        <button (click)="toggleEdit()" 
                class="btn btn-ghost btn-sm">
          Cancel
        </button>
      </div>
    </div>

    <!-- Profile Form -->
    <form [formGroup]="profileForm" class="space-y-6">
      <!-- Account Information Section (Read-only) -->
      <div class="bg-base-100/50 backdrop-blur-sm rounded-xl p-6 border border-base-300/50">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <lucide-icon name="Shield" class="w-5 h-5 text-primary"></lucide-icon>
          Account Information
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- User ID -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">User ID</span>
            </label>
            <div class="flex items-center gap-2">
              <span class="font-mono bg-base-200 px-2 py-1 rounded text-xs cursor-pointer"
                    [title]="user?.uuid">
                {{ user?.uuid ? (user?.uuid | slice:0:8) + '...' + (user?.uuid | slice:-6) : '' }}
              </span>
              <button class="btn btn-xs btn-ghost" type="button" (click)="copyUuid(user?.uuid)">
                <lucide-icon name="Copy" class="w-4 h-4"></lucide-icon>
              </button>
            </div>
          </div>

          <!-- Account Status -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Account Status</span>
            </label>
            <div class="flex items-center gap-2">
              <div class="badge badge-success" *ngIf="user?.active">Active</div>
              <div class="badge badge-error" *ngIf="!user?.active">Inactive</div>
            </div>
          </div>

          <!-- Created Date -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Member Since</span>
            </label>
            <input type="text" 
                   [value]="getDisplayDate(user?.created_at)"
                   readonly
                   class="input input-bordered w-full opacity-70">
          </div>

          <!-- Last Updated -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Last Updated</span>
            </label>
            <input type="text" 
                   [value]="getDisplayDate(user?.updated_at)"
                   readonly
                   class="input input-bordered w-full opacity-70">
          </div>
        </div>
      </div>

      <!-- Personal Information Section -->
      <div class="bg-base-100/50 backdrop-blur-sm rounded-xl p-6 border border-base-300/50">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <lucide-icon name="User" class="w-5 h-5 text-primary"></lucide-icon>
          Personal Information
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- First Name -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">First Name</span>
              <span class="label-text-alt text-error">*</span>
            </label>
            <input type="text" 
                   formControlName="first_name"
                   [readonly]="!isEditing"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('first_name')?.touched"
                   [class.input-error]="profileForm.get('first_name')?.invalid && profileForm.get('first_name')?.touched">
            <label *ngIf="profileForm.get('first_name')?.invalid && profileForm.get('first_name')?.touched" 
                   class="label">
              <span class="label-text-alt text-error">First name is required (min 2 characters)</span>
            </label>
          </div>

          <!-- Last Name -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Last Name</span>
              <span class="label-text-alt text-error">*</span>
            </label>
            <input type="text" 
                   formControlName="last_name"
                   [readonly]="!isEditing"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('last_name')?.touched"
                   [class.input-error]="profileForm.get('last_name')?.invalid && profileForm.get('last_name')?.touched">
            <label *ngIf="profileForm.get('last_name')?.invalid && profileForm.get('last_name')?.touched" 
                   class="label">
              <span class="label-text-alt text-error">Last name is required (min 2 characters)</span>
            </label>
          </div>

          <!-- Email (Read-only) -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Email</span>
            </label>
            <input type="email" 
                   formControlName="email"
                   readonly
                   class="input input-bordered w-full opacity-70">
          </div>

          <!-- Phone -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Phone</span>
            </label>
            <input type="tel" 
                   formControlName="phone"
                   [readonly]="!isEditing"
                   placeholder="+1 (555) 123-4567"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('phone')?.touched">
          </div>

          <!-- Job Title -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Job Title</span>
            </label>
            <input type="text" 
                   formControlName="job_title"
                   [readonly]="!isEditing"
                   placeholder="Software Engineer"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('job_title')?.touched">
          </div>

          <!-- Department -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Department</span>
            </label>
            <input type="text" 
                   formControlName="department"
                   [readonly]="!isEditing"
                   placeholder="Engineering"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('department')?.touched">
          </div>
        </div>
      </div>

      <!-- Bio Section -->
      <div class="bg-base-100/50 backdrop-blur-sm rounded-xl p-6 border border-base-300/50">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <lucide-icon name="FileText" class="w-5 h-5 text-primary"></lucide-icon>
          About
        </h2>
        
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium">Bio</span>
            <span class="label-text-alt">{{ profileForm.get('bio')?.value?.length || 0 }}/500</span>
          </label>
          <textarea formControlName="bio"
                    [readonly]="!isEditing"
                    rows="4"
                    placeholder="Tell us about yourself..."
                    class="textarea textarea-bordered w-full transition-all duration-300"
                    [class.textarea-primary]="isEditing && profileForm.get('bio')?.touched"></textarea>
        </div>
      </div>

      <!-- Preferences Section -->
      <div class="bg-base-100/50 backdrop-blur-sm rounded-xl p-6 border border-base-300/50">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <lucide-icon name="Settings" class="w-5 h-5 text-primary"></lucide-icon>
          Preferences & Settings
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Timezone -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Timezone</span>
            </label>
            <select formControlName="timezone"
                    [disabled]="!isEditing"
                    class="select select-bordered w-full transition-all duration-300"
                    [class.select-primary]="isEditing && profileForm.get('timezone')?.touched">
              <option value="UTC">UTC</option>
              <option value="America/New_York">Eastern Time (ET)</option>
              <option value="America/Chicago">Central Time (CT)</option>
              <option value="America/Denver">Mountain Time (MT)</option>
              <option value="America/Los_Angeles">Pacific Time (PT)</option>
              <option value="Europe/London">London (GMT)</option>
              <option value="Europe/Paris">Paris (CET)</option>
              <option value="Asia/Tokyo">Tokyo (JST)</option>
              <option value="Asia/Shanghai">Shanghai (CST)</option>
              <option value="Asia/Kolkata">India (IST)</option>
            </select>
          </div>

          <!-- Language -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Language</span>
            </label>
            <select formControlName="language"
                    [disabled]="!isEditing"
                    class="select select-bordered w-full transition-all duration-300"
                    [class.select-primary]="isEditing && profileForm.get('language')?.touched">
              <option value="en">English</option>
              <option value="es">Español</option>
              <option value="fr">Français</option>
              <option value="de">Deutsch</option>
              <option value="it">Italiano</option>
              <option value="pt">Português</option>
              <option value="ru">Русский</option>
              <option value="zh">中文</option>
              <option value="ja">日本語</option>
              <option value="ko">한국어</option>
            </select>
          </div>
        </div>

        <!-- Notification Preferences -->
        <div class="mt-6">
          <h3 class="text-md font-medium mb-3">Notification Preferences</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3">
                <input #emailNotif type="checkbox" 
                       [checked]="user?.notification_preferences?.email"
                       [disabled]="!isEditing"
                       (change)="updateNotificationPreference('email', emailNotif.checked)"
                       class="checkbox checkbox-primary">
                <span class="label-text">Email Notifications</span>
              </label>
            </div>
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3">
                <input #pushNotif type="checkbox" 
                       [checked]="user?.notification_preferences?.push"
                       [disabled]="!isEditing"
                       (change)="updateNotificationPreference('push', pushNotif.checked)"
                       class="checkbox checkbox-primary">
                <span class="label-text">Push Notifications</span>
              </label>
            </div>
            <div class="form-control">
              <label class="label cursor-pointer justify-start gap-3">
                <input #inAppNotif type="checkbox" 
                       [checked]="user?.notification_preferences?.in_app"
                       [disabled]="!isEditing"
                       (change)="updateNotificationPreference('in_app', inAppNotif.checked)"
                       class="checkbox checkbox-primary">
                <span class="label-text">In-App Notifications</span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Additional Information -->
      <div class="bg-base-100/50 backdrop-blur-sm rounded-xl p-6 border border-base-300/50">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <lucide-icon name="Globe" class="w-5 h-5 text-primary"></lucide-icon>
          Additional Information
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Location -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Location</span>
            </label>
            <input type="text" 
                   formControlName="location"
                   [readonly]="!isEditing"
                   placeholder="San Francisco, CA"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('location')?.touched">
          </div>

          <!-- Website -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Website</span>
            </label>
            <input type="url" 
                   formControlName="website"
                   [readonly]="!isEditing"
                   placeholder="https://example.com"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('website')?.touched"
                   [class.input-error]="profileForm.get('website')?.invalid && profileForm.get('website')?.touched">
            <label *ngIf="profileForm.get('website')?.invalid && profileForm.get('website')?.touched" 
                   class="label">
              <span class="label-text-alt text-error">Please enter a valid URL</span>
            </label>
          </div>

          <!-- LinkedIn -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">LinkedIn</span>
            </label>
            <input type="text" 
                   formControlName="linkedin"
                   [readonly]="!isEditing"
                   placeholder="linkedin.com/in/username"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('linkedin')?.touched">
          </div>

          <!-- Twitter -->
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">Twitter</span>
            </label>
            <input type="text" 
                   formControlName="twitter"
                   [readonly]="!isEditing"
                   placeholder="@username"
                   class="input input-bordered w-full transition-all duration-300"
                   [class.input-primary]="isEditing && profileForm.get('twitter')?.touched">
          </div>
        </div>
      </div>
    </form>
  </div>
</div> 