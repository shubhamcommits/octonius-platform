<div class="flex items-center gap-8 py-2 px-4 relative" (click)="$event.stopPropagation()">
  <!-- Filter Button with Badge -->
  <div class="relative" *ngIf="showFilter">
    <button 
      class="btn btn-outline btn-sm transition-all duration-150 group relative hover:btn-primary" 
      title="Filter" 
      (click)="onFilter()"
      [class.btn-active]="showFilterDropdown">
      <lucide-icon name="ListFilter" class="w-4 h-4 mr-2"></lucide-icon>
      Filter
      <lucide-icon 
        [name]="showFilterDropdown ? 'ChevronUp' : 'ChevronDown'" 
        class="w-3 h-3 ml-1 transition-transform duration-150">
      </lucide-icon>
      <!-- Active filter badge -->
      <span 
        *ngIf="isFilterActive()" 
        class="absolute -top-1 -right-1 bg-primary text-primary-content text-xs rounded-full w-4 h-4 flex items-center justify-center font-semibold">
        {{ getActiveFilterCount() }}
      </span>
    </button>
  </div>

  <button *ngIf="showAdd" class="btn btn-outline btn-sm transition-all duration-150 hover:btn-primary" title="Add" (click)="onAdd()">
    <lucide-icon name="Plus" class="w-4 h-4 mr-2"></lucide-icon>
    Add
  </button>
  
  <!-- Search Button with Dropdown -->
  <div *ngIf="showSearch" class="relative" (click)="$event.stopPropagation()">
    <button 
      class="btn btn-outline btn-sm transition-all duration-150 hover:btn-primary group relative" 
      title="Search" 
      (click)="toggleSearchDropdown()"
      [class.btn-active]="showSearchDropdown">
      <lucide-icon name="Search" class="w-4 h-4 mr-2"></lucide-icon>
      Search
      <lucide-icon 
        [name]="showSearchDropdown ? 'ChevronUp' : 'ChevronDown'" 
        class="w-3 h-3 ml-1 transition-transform duration-150">
      </lucide-icon>
    </button>
    
    <!-- Search Dropdown -->
    <div 
      *ngIf="showSearchDropdown" 
      class="absolute top-full right-0 mt-1 w-80 bg-base-100 border border-base-300 rounded-lg shadow-xl z-50 animate-in slide-in-from-top-2 duration-200">
      
      <div class="p-4">
        <div class="text-xs font-semibold text-base-content/70 mb-3 uppercase tracking-wide">Search Groups</div>
        <div class="space-y-3">
          <div class="form-control">
            <input 
              type="text" 
              [(ngModel)]="searchTerm"
              (input)="onSearchInput($event)"
              [placeholder]="searchPlaceholder"
              class="input input-bordered input-sm w-full transition-all duration-150 focus:border-primary focus:ring-2 focus:ring-primary/20"
              autofocus>
          </div>
          
          <div class="flex items-center justify-between">
            <button 
              (click)="clearSearch()"
              class="btn btn-ghost btn-xs text-error hover:bg-error/10 hover:text-error transition-all duration-150"
              [disabled]="!searchTerm">
              <lucide-icon name="X" class="w-3 h-3 mr-1"></lucide-icon>
              Clear
            </button>
            <button 
              (click)="applySearch()"
              class="btn btn-primary btn-xs hover:bg-primary/90 transition-all duration-150"
              [disabled]="!searchTerm">
              <lucide-icon name="Search" class="w-3 h-3 mr-1"></lucide-icon>
              Search
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter Dropdown -->
  <div 
    *ngIf="showFilterDropdown" 
    class="absolute top-full left-0 mt-1 w-96 bg-base-100 border border-base-300 rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto animate-in slide-in-from-top-2 duration-200">
    
    <!-- Filter Header -->
    <div class="flex items-center justify-between p-4 border-b border-base-300 bg-base-50">
      <h3 class="text-lg font-semibold text-base-content">Filter Groups</h3>
      <button 
        (click)="closeFilterDropdown()" 
        class="btn btn-ghost btn-sm hover:bg-base-200 transition-colors duration-150">
        <lucide-icon name="X" class="w-4 h-4"></lucide-icon>
      </button>
    </div>

    <!-- Filter Content -->
    <div class="p-4 space-y-6">
      
      <!-- Group Type Filter -->
      <div>
        <label class="text-xs font-semibold text-base-content/70 mb-3 block uppercase tracking-wide">Group Type</label>
        <div class="space-y-2">
          <label *ngFor="let type of groupTypes" class="flex items-center p-2 rounded-md hover:bg-base-200 transition-colors duration-150 cursor-pointer group">
            <input 
              type="checkbox" 
              [checked]="activeFilters.groupType.includes(type.value)"
              (change)="onGroupTypeChange(type.value)"
              class="checkbox checkbox-sm mr-3 group-hover:scale-110 transition-transform duration-150">
            <span class="text-sm font-medium text-base-content">{{ type.label }}</span>
          </label>
        </div>
      </div>

      <!-- Visibility Filter -->
      <div>
        <label class="text-xs font-semibold text-base-content/70 mb-3 block uppercase tracking-wide">Visibility</label>
        <div class="space-y-2">
          <label *ngFor="let visibility of visibilityOptions" class="flex items-center p-2 rounded-md hover:bg-base-200 transition-colors duration-150 cursor-pointer group">
            <input 
              type="checkbox" 
              [checked]="activeFilters.visibility.includes(visibility.value)"
              (change)="onVisibilityChange(visibility.value)"
              class="checkbox checkbox-sm mr-3 group-hover:scale-110 transition-transform duration-150">
            <span class="text-sm font-medium text-base-content">{{ visibility.label }}</span>
          </label>
        </div>
      </div>

      <!-- Member Count Filter -->
      <div>
        <label class="text-xs font-semibold text-base-content/70 mb-3 block uppercase tracking-wide">Member Count</label>
        <select 
          [(ngModel)]="activeFilters.memberCount"
          (change)="onMemberCountChange($event)"
          class="select select-bordered select-sm w-full transition-all duration-150 hover:border-primary focus:border-primary focus:ring-2 focus:ring-primary/20">
          <option *ngFor="let option of memberCountOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <!-- Category Filter -->
      <div *ngIf="availableCategories.length > 0">
        <label class="text-xs font-semibold text-base-content/70 mb-3 block uppercase tracking-wide">Category</label>
        <div class="space-y-2 max-h-32 overflow-y-auto">
          <label *ngFor="let category of availableCategories" class="flex items-center p-2 rounded-md hover:bg-base-200 transition-colors duration-150 cursor-pointer group">
            <input 
              type="checkbox" 
              [checked]="activeFilters.category.includes(category)"
              (change)="onCategoryChange(category)"
              class="checkbox checkbox-sm mr-3 group-hover:scale-110 transition-transform duration-150">
            <span class="text-sm font-medium text-base-content">{{ category }}</span>
          </label>
        </div>
      </div>

      <!-- Department Filter -->
      <div *ngIf="availableDepartments.length > 0">
        <label class="text-xs font-semibold text-base-content/70 mb-3 block uppercase tracking-wide">Department</label>
        <div class="space-y-2 max-h-32 overflow-y-auto">
          <label *ngFor="let department of availableDepartments" class="flex items-center p-2 rounded-md hover:bg-base-200 transition-colors duration-150 cursor-pointer group">
            <input 
              type="checkbox" 
              [checked]="activeFilters.department.includes(department)"
              (change)="onDepartmentChange(department)"
              class="checkbox checkbox-sm mr-3 group-hover:scale-110 transition-transform duration-150">
            <span class="text-sm font-medium text-base-content">{{ department }}</span>
          </label>
        </div>
      </div>

      <!-- Tags Filter -->
      <div *ngIf="availableTags.length > 0">
        <label class="text-xs font-semibold text-base-content/70 mb-3 block uppercase tracking-wide">Tags</label>
        <div class="space-y-2 max-h-32 overflow-y-auto">
          <label *ngFor="let tag of availableTags" class="flex items-center p-2 rounded-md hover:bg-base-200 transition-colors duration-150 cursor-pointer group">
            <input 
              type="checkbox" 
              [checked]="activeFilters.tags.includes(tag)"
              (change)="onTagChange(tag)"
              class="checkbox checkbox-sm mr-3 group-hover:scale-110 transition-transform duration-150">
            <span class="text-sm font-medium text-base-content">{{ tag }}</span>
          </label>
        </div>
      </div>

      <!-- Created Date Filter -->
      <div>
        <label class="text-xs font-semibold text-base-content/70 mb-3 block uppercase tracking-wide">Created Date</label>
        <select 
          [(ngModel)]="activeFilters.createdDate"
          (change)="onCreatedDateChange($event)"
          class="select select-bordered select-sm w-full transition-all duration-150 hover:border-primary focus:border-primary focus:ring-2 focus:ring-primary/20">
          <option *ngFor="let option of createdDateOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

    </div>

    <!-- Filter Actions -->
    <div class="flex items-center justify-between p-4 border-t border-base-300 bg-base-50">
      <button 
        (click)="clearFilters()" 
        class="btn btn-ghost btn-sm text-error hover:bg-error/10 hover:text-error transition-all duration-150">
        <lucide-icon name="X" class="w-4 h-4 mr-1"></lucide-icon>
        Clear All
      </button>
      <div class="flex gap-2">
        <button 
          (click)="closeFilterDropdown()" 
          class="btn btn-outline btn-sm hover:btn-primary transition-all duration-150">
          Cancel
        </button>
        <button 
          (click)="applyFilters()" 
          class="btn btn-primary btn-sm hover:bg-primary/90 transition-all duration-150">
          <lucide-icon name="Check" class="w-4 h-4 mr-1"></lucide-icon>
          Apply Filters
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Search and Filter Pills Display -->
<div *ngIf="isFilterActive() || isSearchActive()" class="px-4 py-2 bg-base-200 border-b border-base-300">
  <div class="flex items-center gap-2 flex-wrap">
    <span class="text-sm text-base-content/60 mr-2">Active:</span>
    
    <!-- Search Pill -->
    <span *ngIf="isSearchActive()" class="badge badge-info badge-sm gap-1">
      <lucide-icon name="Search" class="w-3 h-3"></lucide-icon>
      "{{ searchTerm }}"
      <button (click)="clearSearch()" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
      </button>
    </span>
    
    <!-- Group Type Pills -->
    <span *ngFor="let type of activeFilters.groupType" class="badge badge-primary badge-sm gap-1">
      {{ getGroupTypeLabel(type) }}
      <button (click)="removeGroupTypeFilter(type)" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
      </button>
    </span>
    
    <!-- Visibility Pills -->
    <span *ngFor="let visibility of activeFilters.visibility" class="badge badge-secondary badge-sm gap-1">
      {{ getVisibilityLabel(visibility) }}
      <button (click)="removeVisibilityFilter(visibility)" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
      </button>
    </span>
    
    <!-- Member Count Pill -->
    <span *ngIf="activeFilters.memberCount" class="badge badge-accent badge-sm gap-1">
      {{ getMemberCountLabel(activeFilters.memberCount) }}
      <button (click)="removeMemberCountFilter()" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
      </button>
    </span>
    
    <!-- Category Pills -->
    <span *ngFor="let category of activeFilters.category" class="badge badge-info badge-sm gap-1">
      {{ category }}
      <button (click)="removeCategoryFilter(category)" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
      </button>
    </span>
    
    <!-- Department Pills -->
    <span *ngFor="let department of activeFilters.department" class="badge badge-warning badge-sm gap-1">
      {{ department }}
      <button (click)="removeDepartmentFilter(department)" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
      </button>
    </span>
    
    <!-- Tags Pills -->
    <span *ngFor="let tag of activeFilters.tags" class="badge badge-success badge-sm gap-1">
      {{ tag }}
      <button (click)="removeTagFilter(tag)" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
      </button>
    </span>
    
    <!-- Created Date Pill -->
    <span *ngIf="activeFilters.createdDate" class="badge badge-neutral badge-sm gap-1">
      {{ getCreatedDateLabel(activeFilters.createdDate) }}
      <button (click)="removeCreatedDateFilter()" class="btn btn-ghost btn-xs p-0 h-auto min-h-0">
        <lucide-icon name="X" class="w-3 h-3"></lucide-icon>
  </button>
    </span>
    
    <!-- Clear All Button -->
    <button (click)="clearAll()" class="btn btn-ghost btn-xs text-error">
      Clear all
  </button>
  </div>
</div>

<div class="border-t w-full mt-1 border-gray-400 text-base-content"></div> 