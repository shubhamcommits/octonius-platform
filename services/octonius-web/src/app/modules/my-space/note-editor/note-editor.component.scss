// === MINIMAL SCSS FOR TIPTAP EDITOR ===
// Only styles that can't be handled by Tailwind classes

// Essential animations for status indicators
@keyframes pulse-success {
  0%, 100% { box-shadow: 0 0 0 2px hsl(var(--su)); }
  50% { box-shadow: 0 0 0 8px hsl(var(--su) / 0.3); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  75% { transform: translateX(2px); }
}

// Status dot animations (cannot be done with utility classes)
.status-dot {
  &.animate-pulse-success {
    animation: pulse-success 2s ease-in-out;
  }
  
  &.animate-shake {
    animation: shake 0.5s ease-in-out;
  }
}

// Toolbar active state (if needed beyond what Tailwind provides)
.btn-active {
  background: hsl(var(--p)) !important;
  color: hsl(var(--pc)) !important;
}

// Image upload loading overlay
.relative {
  .absolute {
    transition: opacity 0.2s ease-in-out;
  }
  
  .bg-base-100\/80 {
    backdrop-filter: blur(4px);
  }
  
  .loading-spinner {
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
}

// Custom scrollbar for the editor container
.tiptap-editor {
  scrollbar-width: thin;
  scrollbar-color: hsl(var(--bc) / 0.2) transparent;
  
  &::-webkit-scrollbar {
    width: 6px;
  }
  
  &::-webkit-scrollbar-track {
    background: transparent;
  }
  
  &::-webkit-scrollbar-thumb {
    background: hsl(var(--bc) / 0.2);
    border-radius: 3px;
    
    &:hover {
      background: hsl(var(--bc) / 0.3);
    }
  }
}

// Accessibility and print styles
@media print {
  .tiptap-editor .ProseMirror {
    color: black !important;
    background: white !important;
    
    * {
      color: black !important;
      background: white !important;
    }
  }
}

@media (prefers-reduced-motion: reduce) {
  .tiptap-editor * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

// Full-screen editor styles
.fixed.inset-0 {
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

// Bubble Menu Styles
.bubble-menu {
  position: absolute;
  z-index: 1000;
  transition: opacity 0.2s ease;
  
  &.ProseMirror-widget {
    display: block !important;
    opacity: 1;
  }
  
  .btn {
    transition: all 0.2s ease;
    
    &:hover {
      transform: translateY(-1px);
    }
    
    &.btn-active {
      background-color: hsl(var(--p));
      color: hsl(var(--pc));
      border-color: hsl(var(--p));
    }
  }
}

// Divider styles for toolbar
.divider-horizontal {
  width: 1px;
  height: 20px;
  background-color: hsl(var(--bc) / 0.2);
  margin: 0 8px;
  flex-shrink: 0;
}

// Tiptap Editor Styles
.tiptap-editor {
  // Focus styles
  &:focus {
    outline: none;
  }

  // Content styles
  .ProseMirror {
    // Essential ProseMirror styles
    white-space: pre-wrap;
    word-wrap: break-word;
    -webkit-font-variant-ligatures: none;
    font-variant-ligatures: none;
    font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
    
    outline: none;
    padding: 3rem 6rem;
    line-height: 1.6;
    font-size: 16px;
    color: inherit;
    background: transparent;
    min-height: 100%;
    width: 100%;
    
    // Headings
    h1, h2, h3, h4, h5, h6 {
      line-height: 1.2;
      margin-top: 2rem;
      margin-bottom: 1rem;
      font-weight: 600;
      
      &:first-child {
        margin-top: 0;
      }
    }

    h1 { font-size: 2.25rem; }
    h2 { font-size: 1.875rem; }
    h3 { font-size: 1.5rem; }
    h4 { font-size: 1.25rem; }
    h5 { font-size: 1.125rem; }
    h6 { font-size: 1rem; }

    // Paragraphs
    p {
      margin-bottom: 1rem;
      
      &:last-child {
        margin-bottom: 0;
      }
    }

    // Lists
    ul, ol {
      margin: 1rem 0;
      padding-left: 1.5rem;
      
      li {
        margin-bottom: 0.5rem;
        
        &:last-child {
          margin-bottom: 0;
        }
      }
    }

    // Task lists
    ul[data-type="taskList"] {
      list-style: none;
      padding-left: 0;
      
      li {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        
        input[type="checkbox"] {
          margin-top: 0.25rem;
          cursor: pointer;
        }
      }
    }

    // Blockquotes
    blockquote {
      border-left: 4px solid hsl(var(--p));
      padding-left: 1rem;
      margin: 1.5rem 0;
      font-style: italic;
      color: hsl(var(--bc) / 0.8);
    }

    // Code blocks
    pre {
      background-color: hsl(var(--b2));
      border: 1px solid hsl(var(--b3));
      border-radius: 0.5rem;
      padding: 1rem;
      margin: 1rem 0;
      overflow-x: auto;
      white-space: pre;
      
      code {
        background: transparent;
        padding: 0;
        font-size: 0.875rem;
        font-family: 'Courier New', monospace;
        white-space: pre;
      }
    }

    // Inline code
    code {
      background-color: hsl(var(--b2));
      color: hsl(var(--bc));
      padding: 0.125rem 0.25rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      font-family: 'Courier New', monospace;
    }

    // Links
    a {
      color: hsl(var(--p));
      text-decoration: underline;
      cursor: pointer;
      
      &:hover {
        color: hsl(var(--pf));
      }
    }

    // Tables
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      margin: 1.5rem 0;
      border-radius: 0.5rem;
      overflow: hidden;
      background-color: hsl(var(--b1));
      box-shadow: 0 0 0 2px hsl(var(--bc) / 0.2);
      
      th, td {
        border-right: 2px solid hsl(var(--bc) / 0.1);
        border-bottom: 2px solid hsl(var(--bc) / 0.1);
        padding: 0.75rem;
        text-align: left;
        position: relative;
        
        &:last-child {
          border-right: none;
        }
      }
      
      tr:last-child td {
        border-bottom: none;
      }
      
      th {
        background-color: hsl(var(--b3));
        font-weight: 600;
        color: hsl(var(--bc));
        border-bottom: 2px solid hsl(var(--bc) / 0.2);
      }
      
      td {
        background-color: hsl(var(--b1));
      }
      
      tr:hover td {
        background-color: hsl(var(--b2));
      }
      
      // Selected cells
      td.selectedCell,
      th.selectedCell {
        background-color: hsl(var(--p) / 0.15) !important;
        box-shadow: inset 0 0 0 2px hsl(var(--p) / 0.5);
      }
      
      // Table resizing handle
      .column-resize-handle {
        position: absolute;
        right: -2px;
        top: 0;
        bottom: -2px;
        width: 4px;
        background-color: hsl(var(--p));
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s;
      }
      
      &:hover .column-resize-handle {
        opacity: 1;
        pointer-events: auto;
        cursor: col-resize;
      }
    }

    // Images
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 1rem auto;
      border-radius: 0.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      
      &.ProseMirror-selectednode {
        outline: 2px solid hsl(var(--p));
      }
    }

    // Horizontal rule
    hr {
      border: none;
      border-top: 2px solid hsl(var(--b3));
      margin: 2rem 0;
    }

    // Highlights
    mark {
      background-color: hsl(var(--wa) / 0.3);
      padding: 0.125rem 0.25rem;
      border-radius: 0.25rem;
    }

    // Text alignment
    &[style*="text-align: center"] { text-align: center; }
    &[style*="text-align: right"] { text-align: right; }
    &[style*="text-align: justify"] { text-align: justify; }
    
    // Placeholder
    .is-editor-empty:first-child::before {
      content: attr(data-placeholder);
      float: left;
      color: hsl(var(--bc) / 0.4);
      pointer-events: none;
      height: 0;
    }

    // Selection styles
    ::selection {
      background: hsl(var(--p) / 0.2);
    }

    // Focus styles for contenteditable
    &:focus {
      outline: none;
    }

    // Prevent unwanted spacing
    * {
      margin: 0;
    }

    // Re-apply margins to specific elements
    h1, h2, h3, h4, h5, h6,
    p, ul, ol, blockquote, pre, hr, table {
      margin-top: 0;
      margin-bottom: 1rem;
      
      &:first-child {
        margin-top: 0;
      }
      
      &:last-child {
        margin-bottom: 0;
      }
    }
  }
}

// Dark mode table enhancements
[data-theme="night"] .tiptap-editor .ProseMirror table,
.dark .tiptap-editor .ProseMirror table {
  box-shadow: 0 0 0 2px hsl(var(--bc) / 0.3);
  
  th {
    background-color: hsl(var(--b3) / 0.8);
    border-bottom-color: hsl(var(--bc) / 0.3);
  }
  
  th, td {
    border-color: hsl(var(--bc) / 0.2);
  }
}

// Responsive adjustments
@media (max-width: 1024px) {
  .tiptap-editor .ProseMirror {
    padding: 2rem 3rem;
  }
}

@media (max-width: 768px) {
  .tiptap-editor .ProseMirror {
    padding: 1.5rem 2rem;
    font-size: 14px;
  }
  
  .divider-horizontal {
    display: none;
  }
}

@media (max-width: 480px) {
  .tiptap-editor .ProseMirror {
    padding: 1rem;
  }
}

// Help Modal styles
.modal-box {
  max-height: calc(100vh - 5em);
  
  .kbd {
    font-family: monospace;
    background-color: hsl(var(--b3));
    border: 1px solid hsl(var(--bc) / 0.2);
    border-radius: 0.25rem;
    padding: 0.125rem 0.375rem;
    font-size: 0.875rem;
    white-space: nowrap;
    
    &.kbd-xs {
      font-size: 0.75rem;
      padding: 0.125rem 0.25rem;
    }
    
    &.kbd-sm {
      font-size: 0.8125rem;
    }
  }
  
  .grid > div {
    transition: background-color 0.2s ease;
    
    &:hover {
      background-color: hsl(var(--b3));
    }
  }
}

// Emoji and GIF picker styles
.emoji-picker-container,
.gif-picker-container {
  max-height: 400px;
  
  &:before {
    content: '';
    position: absolute;
    top: -8px;
    left: 12px;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-bottom: 8px solid hsl(var(--b3));
  }
  
  &:after {
    content: '';
    position: absolute;
    top: -7px;
    left: 12px;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-bottom: 8px solid hsl(var(--b1));
  }
  
  .emoji-grid {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 2px;
    
    button {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s ease;
      
      &:hover {
        background-color: hsl(var(--b3));
        transform: scale(1.2);
      }
    }
  }
  
  .gif-grid {
    img {
      border-radius: 0.5rem;
      object-fit: cover;
      width: 100%;
      height: 100%;
      transition: opacity 0.2s ease;
      
      &:hover {
        opacity: 0.8;
      }
    }
  }
}

// Print styles
@media print {
  .fixed.inset-0 {
    position: static;
  }
  
  .bubble-menu,
  .flex-none:not(:last-child),
  .modal {
    display: none !important;
  }
  
  .tiptap-editor .ProseMirror {
    padding: 0;
  }
}



