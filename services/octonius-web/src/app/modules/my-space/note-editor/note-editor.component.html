<div class="fixed inset-0 bg-base-100 text-base-content z-50 animate-fadeIn">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex flex-col h-full animate-fadeIn">
    <!-- Header Skeleton -->
    <div class="flex-none bg-base-100 border-b border-base-300 px-6 py-4">
      <div class="flex items-center justify-between mb-4">
        <div class="w-16 h-8 bg-base-300 rounded animate-pulse"></div>
        <div class="flex items-center gap-4">
          <div class="w-24 h-6 bg-base-300 rounded animate-pulse"></div>
          <div class="w-20 h-8 bg-base-300 rounded animate-pulse"></div>
        </div>
      </div>
      <div class="w-3/4 h-10 bg-base-300 rounded animate-pulse mx-auto"></div>
    </div>

    <!-- Toolbar Skeleton -->
    <div class="flex-none bg-base-100 border-b border-base-300 px-6 py-3">
      <div class="flex flex-wrap items-center gap-2">
        <div class="flex items-center gap-1">
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
        </div>
        <div class="w-px h-6 bg-base-300"></div>
        <div class="w-24 h-8 bg-base-300 rounded animate-pulse"></div>
        <div class="w-px h-6 bg-base-300"></div>
        <div class="flex items-center gap-1">
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
        </div>
        <div class="w-px h-6 bg-base-300"></div>
        <div class="flex items-center gap-1">
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
        </div>
        <div class="w-px h-6 bg-base-300"></div>
        <div class="flex items-center gap-1">
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
        </div>
        <div class="w-px h-6 bg-base-300"></div>
        <div class="flex items-center gap-1">
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
          <div class="w-8 h-8 bg-base-300 rounded animate-pulse"></div>
        </div>
      </div>
    </div>

    <!-- Editor Content Skeleton -->
    <div class="flex-1 overflow-auto bg-base-100 px-6 py-8">
      <div class="space-y-4">
        <div class="w-full h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-3/4 h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-1/2 h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-full h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-2/3 h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-full h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-4/5 h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-1/3 h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-full h-6 bg-base-300 rounded animate-pulse"></div>
        <div class="w-2/3 h-6 bg-base-300 rounded animate-pulse"></div>
      </div>
    </div>

    <!-- Status Bar Skeleton -->
    <div class="flex-none bg-base-200 border-t border-base-300 px-6 py-2">
      <div class="flex items-center justify-between text-sm text-base-content/60">
        <div class="flex items-center gap-4">
          <div class="w-24 h-4 bg-base-300 rounded animate-pulse"></div>
          <div class="w-20 h-4 bg-base-300 rounded animate-pulse"></div>
          <div class="w-32 h-4 bg-base-300 rounded animate-pulse"></div>
        </div>
        <div class="flex items-center gap-2">
          <div class="w-12 h-4 bg-base-300 rounded animate-pulse"></div>
          <div class="w-6 h-6 bg-base-300 rounded-full animate-pulse"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="flex-1 flex items-center justify-center h-full">
    <div class="text-center">
      <p class="text-error mb-4">{{ error }}</p>
      <button class="btn btn-primary" (click)="goBackToFiles()">Go Back</button>
    </div>
  </div>

  <!-- Professional Editor Interface -->
  <div *ngIf="!isLoading && !error" class="flex flex-col h-full">
    <!-- Combined Header and Toolbar - Full Width -->
    <div class="flex-none bg-base-100 border-b border-base-300 px-6 py-4">
      <div class="flex items-center justify-between gap-4">
        <!-- Left side: Back button and toolbar -->
        <div class="flex items-center gap-4">
          <button 
            class="btn btn-ghost btn-sm"
            (click)="goBackToFiles()"
            title="Back to Files">
            <lucide-icon name="ArrowLeft" class="w-5 h-5"></lucide-icon>
            Back
          </button>
          
          <!-- Toolbar -->
          <div class="flex flex-wrap items-center gap-2">
        <!-- Undo/Redo -->
        <div class="flex items-center gap-1">
          <button 
            class="btn btn-ghost btn-sm"
            [disabled]="!canUndo()"
            (click)="undo()"
            title="Undo (Ctrl+Z)">
            <lucide-icon name="Undo" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [disabled]="!canRedo()"
            (click)="redo()"
            title="Redo (Ctrl+Y)">
            <lucide-icon name="Redo" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
        <div class="divider divider-horizontal"></div>
        <!-- Heading Dropdown -->
        <div class="dropdown">
          <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
            <span class="text-sm font-medium">{{ getCurrentHeadingText() }}</span>
            <lucide-icon name="ChevronDown" class="w-4 h-4"></lucide-icon>
          </div>
          <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52 border border-base-300">
            <li><a (click)="setParagraph()" [class.active]="isActive('paragraph')">Paragraph</a></li>
            <li><a (click)="setHeading(1)" [class.active]="isActive('heading', { level: 1 })">Heading 1</a></li>
            <li><a (click)="setHeading(2)" [class.active]="isActive('heading', { level: 2 })">Heading 2</a></li>
            <li><a (click)="setHeading(3)" [class.active]="isActive('heading', { level: 3 })">Heading 3</a></li>
            <li><a (click)="setHeading(4)" [class.active]="isActive('heading', { level: 4 })">Heading 4</a></li>
            <li><a (click)="setHeading(5)" [class.active]="isActive('heading', { level: 5 })">Heading 5</a></li>
            <li><a (click)="setHeading(6)" [class.active]="isActive('heading', { level: 6 })">Heading 6</a></li>
          </ul>
        </div>
        <div class="divider divider-horizontal"></div>
        <!-- Text Formatting -->
        <div class="flex items-center gap-1">
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('bold')"
            (click)="toggleBold()"
            title="Bold (Ctrl+B)">
            <lucide-icon name="Bold" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('italic')"
            (click)="toggleItalic()"
            title="Italic (Ctrl+I)">
            <lucide-icon name="Italic" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('underline')"
            (click)="toggleUnderline()"
            title="Underline (Ctrl+U)">
            <lucide-icon name="Underline" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('strike')"
            (click)="toggleStrike()"
            title="Strikethrough">
            <lucide-icon name="Strikethrough" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
        <div class="divider divider-horizontal"></div>
        <!-- Text Alignment -->
        <div class="flex items-center gap-1">
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive({ textAlign: 'left' })"
            (click)="setTextAlign('left')"
            title="Align Left">
            <lucide-icon name="AlignLeft" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive({ textAlign: 'center' })"
            (click)="setTextAlign('center')"
            title="Align Center">
            <lucide-icon name="AlignCenter" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive({ textAlign: 'right' })"
            (click)="setTextAlign('right')"
            title="Align Right">
            <lucide-icon name="AlignRight" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive({ textAlign: 'justify' })"
            (click)="setTextAlign('justify')"
            title="Justify">
            <lucide-icon name="AlignJustify" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
        <div class="divider divider-horizontal"></div>
        <!-- Lists -->
        <div class="flex items-center gap-1">
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('bulletList')"
            (click)="toggleBulletList()"
            title="Bullet List">
            <lucide-icon name="List" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('orderedList')"
            (click)="toggleOrderedList()"
            title="Numbered List">
            <lucide-icon name="ListOrdered" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('taskList')"
            (click)="toggleTaskList()"
            title="Task List">
            <lucide-icon name="ListTodo" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
        <div class="divider divider-horizontal"></div>
        <!-- More Options -->
        <div class="flex items-center gap-1">
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('blockquote')"
            (click)="toggleBlockquote()"
            title="Quote">
            <lucide-icon name="Quote" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            [class.btn-active]="isActive('codeBlock')"
            (click)="toggleCodeBlock()"
            title="Code Block">
            <lucide-icon name="Code" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            class="btn btn-ghost btn-sm"
            (click)="insertHorizontalRule()"
            title="Horizontal Rule">
            <lucide-icon name="Minus" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
          </div>
        </div>
        
        <!-- Right side: Save status and button -->
        <div class="flex items-center gap-4">
          <!-- Save Status -->
          <div class="flex items-center gap-2 text-sm" [class]="getSaveStatusClass()">
            <span *ngIf="saveStatus === 'saving'" class="loading loading-spinner loading-xs"></span>
            <span>{{ getSaveStatusText() }}</span>
          </div>
          <!-- Manual Save Button -->
          <button 
            class="btn btn-primary btn-sm"
            (click)="saveNow()"
            [disabled]="isSaving || saveStatus === 'saved'"
            title="Save Now (Ctrl+S)">
            <lucide-icon name="Save" class="w-4 h-4"></lucide-icon>
            Save
          </button>
        </div>
      </div>
    </div>

    <!-- Centered Content Area -->
    <div class="flex-1 overflow-auto bg-base-100 flex justify-center">
      <div class="w-full max-w-3xl px-6 py-8">
              <!-- Note Title -->
      <input 
        type="text" 
        [(ngModel)]="noteTitle"
        (input)="onTitleChange()"
        placeholder="Untitled Note"
        class="input input-ghost text-3xl font-bold w-full p-0 border-none focus:outline-none bg-transparent text-base-content placeholder-base-content/50 mb-8 text-center"
        maxlength="200">
        
        <!-- Editor Content Area -->
        <div #editorElement class="tiptap-editor min-h-[400px] w-full"></div>
      </div>
    </div>

    <!-- Bottom Status Bar - Full Width -->
    <div class="flex-none bg-base-200 border-t border-base-300 px-6 py-2">
      <div class="flex items-center justify-between text-sm text-base-content/60">
        <div class="flex items-center gap-4">
          <span>{{ getCharacterCount() }} characters</span>
          <span>{{ getWordCount() }} words</span>
          <span>Last edited: {{ lastEdited | date:'short' }}</span>
        </div>
        <div class="flex items-center gap-2">
          <span>{{ createdByUser?.first_name || 'Unknown User' }} {{ createdByUser?.last_name || 'Unknown User' }}</span>
          <div class="avatar">
            <div class="w-6 h-6 rounded-full">
              <img [src]="getUserAvatarUrl(createdByUser)" [alt]="createdByUser?.first_name || createdByUser?.last_name || 'User'" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bubble Menu (hidden, will be positioned by Tiptap) -->
  <div #bubbleMenuElement class="bubble-menu">
    <div class="flex items-center gap-2 bg-base-200 border border-base-300 rounded-lg shadow-lg p-3">
      <!-- Bold -->
      <button 
        class="btn btn-ghost btn-sm"
        [class.btn-active]="isActive('bold')"
        (click)="toggleBold()"
        title="Bold">
        <lucide-icon name="Bold" class="w-4 h-4"></lucide-icon>
      </button>
      
      <!-- Italic -->
      <button 
        class="btn btn-ghost btn-sm"
        [class.btn-active]="isActive('italic')"
        (click)="toggleItalic()"
        title="Italic">
        <lucide-icon name="Italic" class="w-4 h-4"></lucide-icon>
      </button>
      
      <!-- Underline -->
      <button 
        class="btn btn-ghost btn-sm"
        [class.btn-active]="isActive('underline')"
        (click)="toggleUnderline()"
        title="Underline">
        <lucide-icon name="Underline" class="w-4 h-4"></lucide-icon>
      </button>
      
      <!-- Code -->
      <button 
        class="btn btn-ghost btn-sm"
        [class.btn-active]="isActive('code')"
        (click)="toggleCode()"
        title="Code">
        <lucide-icon name="Code" class="w-4 h-4"></lucide-icon>
      </button>
      
      <!-- Link -->
      <button 
        class="btn btn-ghost btn-sm"
        [class.btn-active]="isActive('link')"
        (click)="setLink()"
        title="Link">
        <lucide-icon name="Link" class="w-4 h-4"></lucide-icon>
      </button>
    </div>
  </div>
</div> 