name: ðŸ¤” Determine Action

on:
  workflow_call:
    inputs:
      environment:
        required: true
        type: string
        description: 'Environment to deploy to'
      action:
        required: true
        type: string
        description: 'Action to perform (plan/apply/destroy)'

jobs:
  validate-env:
    name: ðŸ” Validate Environment Variables
    uses: ./.github/workflows/validate-env.yml
    with:
      required_vars: GITHUB_EVENT_NAME,GITHUB_REF
      job_name: determine-action

  determine:
    name: ðŸ¤” Determine Action
    needs: validate-env
    runs-on: ubuntu-latest
    outputs:
      should-apply: ${{ steps.outputs.should-apply }}
    
    steps:
      - name: ðŸ¤” Determine Action
        id: action
        run: |
          # Default to plan
          SHOULD_APPLY="false"
          
          # Check if we should apply
          if [[ "${{ inputs.action }}" == "apply" ]]; then
            SHOULD_APPLY="true"
          fi
          
          echo "should-apply=$SHOULD_APPLY" >> $GITHUB_OUTPUT
          echo "Action: ${{ inputs.action }}"
          echo "Should Apply: $SHOULD_APPLY" 